<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ö–æ–∑–∞—Ü—å–∫–∞ –ê—Ä–µ–Ω–∞ üá∫üá¶</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      background: linear-gradient(180deg, #003C8F, #FFD700);
      font-family: Arial, sans-serif;
      color: #fff;
      min-height: 100vh;
      padding: 10px;
    }

    .container {
      max-width: 400px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      padding: 15px;
      background: rgba(0,0,0,0.3);
      border-radius: 12px;
      margin-bottom: 10px;
    }

    .header h1 {
      font-size: 24px;
      margin-bottom: 10px;
    }

    .resources {
      display: flex;
      justify-content: space-around;
      font-size: 18px;
    }

    .tabs {
      display: flex;
      gap: 5px;
      margin-bottom: 10px;
    }

    .tab {
      flex: 1;
      padding: 12px;
      background: rgba(0,0,0,0.3);
      border: none;
      color: #fff;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .tab.active {
      background: #FFD700;
      color: #000;
      font-weight: bold;
    }

    .screen {
      display: none;
      background: rgba(0,0,0,0.25);
      padding: 20px;
      border-radius: 12px;
      min-height: 400px;
    }

    .screen.active {
      display: block;
    }

    /* –ê–†–ï–ù–ê */
    .enemy-card {
      background: rgba(255,0,0,0.2);
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      margin-bottom: 20px;
    }

    .enemy-name {
      font-size: 22px;
      margin-bottom: 10px;
    }

    .enemy-hp {
      font-size: 28px;
      color: #ff4444;
      margin: 15px 0;
    }

    .enemy-level {
      font-size: 14px;
      color: #ffaa00;
    }

    .btn {
      width: 100%;
      padding: 16px;
      font-size: 20px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      margin-top: 10px;
      font-weight: bold;
      transition: transform 0.1s;
    }

    .btn:active {
      transform: scale(0.96);
    }

    .btn-attack {
      background: #ff4444;
      color: #fff;
    }

    .btn-primary {
      background: #FFD700;
      color: #000;
    }

    /* –ú–Ü–°–¢–û */
    .building {
      background: rgba(255,255,255,0.1);
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 15px;
    }

    .building-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .building-title {
      font-size: 18px;
    }

    .building-level {
      background: #FFD700;
      color: #000;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: bold;
    }

    .building-desc {
      font-size: 14px;
      color: #ddd;
      margin-bottom: 10px;
    }

    .building-cost {
      font-size: 16px;
      margin-bottom: 10px;
    }

    .btn-upgrade {
      background: #4CAF50;
      color: #fff;
      padding: 10px;
      font-size: 16px;
    }

    .btn-upgrade:disabled {
      background: #666;
      cursor: not-allowed;
      opacity: 0.5;
    }

    /* –°–¢–ê–¢–ò–°–¢–ò–ö–ê */
    .stats-grid {
      display: grid;
      gap: 15px;
    }

    .stat-card {
      background: rgba(255,255,255,0.1);
      padding: 15px;
      border-radius: 12px;
      text-align: center;
    }

    .stat-value {
      font-size: 32px;
      font-weight: bold;
      color: #FFD700;
      margin: 10px 0;
    }

    .stat-label {
      font-size: 14px;
      color: #ddd;
    }

    .message {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.9);
      color: #FFD700;
      padding: 15px 30px;
      border-radius: 12px;
      font-size: 18px;
      font-weight: bold;
      z-index: 1000;
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from {
        top: -100px;
        opacity: 0;
      }
      to {
        top: 20px;
        opacity: 1;
      }
    }
  </style>
</head>
<body>

<div class="container">
  <!-- –®–ê–ü–ö–ê -->
  <div class="header">
    <h1>‚öîÔ∏è –ö–æ–∑–∞—Ü—å–∫–∞ –ê—Ä–µ–Ω–∞</h1>
    <div class="resources">
      <div>üèÜ <span id="wins">0</span></div>
      <div>üí∞ <span id="gold">0</span></div>
      <div>‚ö° –°–∏–ª–∞: <span id="power">1</span></div>
    </div>
  </div>

  <!-- –¢–ê–ë–ò -->
  <div class="tabs">
    <button class="tab active" onclick="switchTab('arena')">‚öîÔ∏è –ê—Ä–µ–Ω–∞</button>
    <button class="tab" onclick="switchTab('city')">üè∞ –ú—ñ—Å—Ç–æ</button>
    <button class="tab" onclick="switchTab('stats')">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
  </div>

  <!-- –ï–ö–†–ê–ù –ê–†–ï–ù–ò -->
  <div id="arena" class="screen active">
    <div class="enemy-card">
      <div class="enemy-name" id="enemyName">–ó–∞–≥–∞—Ä–±–Ω–∏–∫</div>
      <div class="enemy-level" id="enemyLevel">–†—ñ–≤–µ–Ω—å 1</div>
      <div class="enemy-hp">‚ù§Ô∏è <span id="enemyHp">20</span></div>
    </div>
    <button class="btn btn-attack" onclick="attack()">‚öîÔ∏è –£–¥–∞—Ä (<span id="damage">1</span> —à–∫–æ–¥–∏)</button>
  </div>

  <!-- –ï–ö–†–ê–ù –ú–Ü–°–¢–ê -->
  <div id="city" class="screen">
    <div class="building">
      <div class="building-header">
        <div class="building-title">‚öîÔ∏è –ö—É–∑–Ω—è</div>
        <div class="building-level">–†—ñ–≤–µ–Ω—å <span id="forgeLevel">1</span></div>
      </div>
      <div class="building-desc">–ó–±—ñ–ª—å—à—É—î —Å–∏–ª—É –∞—Ç–∞–∫–∏ –Ω–∞ +1</div>
      <div class="building-cost">üí∞ –í–∞—Ä—Ç—ñ—Å—Ç—å: <span id="forgeCost">50</span></div>
      <button class="btn btn-upgrade" onclick="upgradeBuilding('forge')" id="forgeBtn">–ü–æ–∫—Ä–∞—â–∏—Ç–∏</button>
    </div>

    <div class="building">
      <div class="building-header">
        <div class="building-title">üí∞ –°–∫–∞—Ä–±–Ω–∏—Ü—è</div>
        <div class="building-level">–†—ñ–≤–µ–Ω—å <span id="treasuryLevel">1</span></div>
      </div>
      <div class="building-desc">+10 –∑–æ–ª–æ—Ç–∞ –∑–∞ –ø–µ—Ä–µ–º–æ–≥—É</div>
      <div class="building-cost">üí∞ –í–∞—Ä—Ç—ñ—Å—Ç—å: <span id="treasuryCost">100</span></div>
      <button class="btn btn-upgrade" onclick="upgradeBuilding('treasury')" id="treasuryBtn">–ü–æ–∫—Ä–∞—â–∏—Ç–∏</button>
    </div>

    <div class="building">
      <div class="building-header">
        <div class="building-title">üè∞ –§–æ—Ä—Ç–µ—Ü—è</div>
        <div class="building-level">–†—ñ–≤–µ–Ω—å <span id="fortressLevel">1</span></div>
      </div>
      <div class="building-desc">–í—ñ–¥–∫—Ä–∏–≤–∞—î —Å–∏–ª—å–Ω—ñ—à–∏—Ö –≤–æ—Ä–æ–≥—ñ–≤</div>
      <div class="building-cost">üí∞ –í–∞—Ä—Ç—ñ—Å—Ç—å: <span id="fortressCost">200</span></div>
      <button class="btn btn-upgrade" onclick="upgradeBuilding('fortress')" id="fortressBtn">–ü–æ–∫—Ä–∞—â–∏—Ç–∏</button>
    </div>
  </div>

  <!-- –ï–ö–†–ê–ù –°–¢–ê–¢–ò–°–¢–ò–ö–ò -->
  <div id="stats" class="screen">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-label">–í—Å—å–æ–≥–æ –ø–µ—Ä–µ–º–æ–≥</div>
        <div class="stat-value" id="totalWins">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">–ó–∞—Ä–æ–±–ª–µ–Ω–æ –∑–æ–ª–æ—Ç–∞</div>
        <div class="stat-value" id="totalGold">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">–ü–æ—Ç–æ—á–Ω–∞ —Å–∏–ª–∞</div>
        <div class="stat-value" id="totalPower">1</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">–ù–∞–π—Å–∏–ª—å–Ω—ñ—à–∏–π –≤–æ—Ä–æ–≥</div>
        <div class="stat-value" id="maxEnemy">1</div>
      </div>
    </div>
    <button class="btn btn-primary" onclick="resetProgress()" style="margin-top: 20px;">üîÑ –°–∫–∏–Ω—É—Ç–∏ –ø—Ä–æ–≥—Ä–µ—Å</button>
  </div>
</div>

<script>
  const tg = window.Telegram.WebApp;
  tg.ready();
  tg.expand();

  // –í–û–†–û–ì–ò
  const enemies = [
    { name: "–ó–∞–≥–∞—Ä–±–Ω–∏–∫", hp: 20, gold: 10, level: 1 },
    { name: "–í–æ—è–∫", hp: 35, gold: 20, level: 2 },
    { name: "–û–ø—Ä–∏—á–Ω–∏–∫", hp: 60, gold: 35, level: 3 },
    { name: "–®–ª—è—Ö—Ç–∏—á", hp: 100, gold: 60, level: 4 },
    { name: "–ë–æ—è—Ä–∏–Ω", hp: 150, gold: 100, level: 5 },
    { name: "–í–æ—î–≤–æ–¥–∞", hp: 250, gold: 180, level: 6 },
    { name: "–ì–µ–Ω–µ—Ä–∞–ª", hp: 400, gold: 300, level: 7 }
  ];

  // –°–¢–ê–ù –ì–†–ò
  let gameState = {
    wins: 0,
    gold: 0,
    totalGold: 0,
    power: 1,
    currentEnemy: 0,
    enemyHp: 20,
    buildings: {
      forge: 1,
      treasury: 1,
      fortress: 1
    }
  };

  // –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø
  function loadGame() {
    if (tg.CloudStorage) {
      tg.CloudStorage.getItem('gameState', (err, data) => {
        if (data) {
          gameState = JSON.parse(data);
          spawnEnemy();
          updateUI();
        } else {
          spawnEnemy();
        }
      });
    } else {
      const saved = localStorage.getItem('kozakGame');
      if (saved) {
        gameState = JSON.parse(saved);
        spawnEnemy();
      }
      updateUI();
    }
  }

  // –ó–ë–ï–†–ï–ñ–ï–ù–ù–Ø
  function saveGame() {
    const data = JSON.stringify(gameState);
    if (tg.CloudStorage) {
      tg.CloudStorage.setItem('gameState', data);
    } else {
      localStorage.setItem('kozakGame', data);
    }
  }

  // –°–¢–í–û–†–ï–ù–ù–Ø –í–û–†–û–ì–ê
  function spawnEnemy() {
    const maxLevel = Math.min(gameState.buildings.fortress, enemies.length - 1);
    gameState.currentEnemy = Math.floor(Math.random() * (maxLevel + 1));
    const enemy = enemies[gameState.currentEnemy];
    gameState.enemyHp = enemy.hp;
  }

  // –ê–¢–ê–ö–ê
  function attack() {
    gameState.enemyHp -= gameState.power;
    tg.HapticFeedback.impactOccurred("medium");

    if (gameState.enemyHp <= 0) {
      const enemy = enemies[gameState.currentEnemy];
      const goldReward = enemy.gold + (gameState.buildings.treasury - 1) * 10;
      
      gameState.wins++;
      gameState.gold += goldReward;
      gameState.totalGold += goldReward;

      showMessage(`üèÜ –ü–µ—Ä–µ–º–æ–≥–∞! +${goldReward} üí∞`);
      tg.HapticFeedback.notificationOccurred("success");

      spawnEnemy();
    }

    updateUI();
    saveGame();
  }

  // –ü–û–ö–†–ê–©–ï–ù–ù–Ø –ë–£–î–Ü–í–õ–Ü
  function upgradeBuilding(type) {
    const costs = {
      forge: 50 * gameState.buildings.forge,
      treasury: 100 * gameState.buildings.treasury,
      fortress: 200 * gameState.buildings.fortress
    };

    const cost = costs[type];

    if (gameState.gold >= cost) {
      gameState.gold -= cost;
      gameState.buildings[type]++;

      if (type === 'forge') {
        gameState.power = gameState.buildings.forge;
      }

      showMessage(`‚úÖ –ü–æ–∫—Ä–∞—â–µ–Ω–æ!`);
      tg.HapticFeedback.notificationOccurred("success");
      updateUI();
      saveGame();
    } else {
      showMessage(`‚ùå –ù–µ –≤–∏—Å—Ç–∞—á–∞—î –∑–æ–ª–æ—Ç–∞`);
      tg.HapticFeedback.notificationOccurred("error");
    }
  }

  // –û–ù–û–í–õ–ï–ù–ù–Ø UI
  function updateUI() {
    const enemy = enemies[gameState.currentEnemy];

    // –®–∞–ø–∫–∞
    document.getElementById('wins').textContent = gameState.wins;
    document.getElementById('gold').textContent = gameState.gold;
    document.getElementById('power').textContent = gameState.power;
    document.getElementById('damage').textContent = gameState.power;

    // –í–æ—Ä–æ–≥
    document.getElementById('enemyName').textContent = enemy.name;
    document.getElementById('enemyLevel').textContent = `–†—ñ–≤–µ–Ω—å ${enemy.level}`;
    document.getElementById('enemyHp').textContent = gameState.enemyHp;

    // –ë—É–¥—ñ–≤–ª—ñ
    document.getElementById('forgeLevel').textContent = gameState.buildings.forge;
    document.getElementById('forgeCost').textContent = 50 * gameState.buildings.forge;
    document.getElementById('forgeBtn').disabled = gameState.gold < 50 * gameState.buildings.forge;

    document.getElementById('treasuryLevel').textContent = gameState.buildings.treasury;
    document.getElementById('treasuryCost').textContent = 100 * gameState.buildings.treasury;
    document.getElementById('treasuryBtn').disabled = gameState.gold < 100 * gameState.buildings.treasury;

    document.getElementById('fortressLevel').textContent = gameState.buildings.fortress;
    document.getElementById('fortressCost').textContent = 200 * gameState.buildings.fortress;
    document.getElementById('fortressBtn').disabled = gameState.gold < 200 * gameState.buildings.fortress || gameState.buildings.fortress >= enemies.length;

    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    document.getElementById('totalWins').textContent = gameState.wins;
    document.getElementById('totalGold').textContent = gameState.totalGold;
    document.getElementById('totalPower').textContent = gameState.power;
    document.getElementById('maxEnemy').textContent = Math.max(gameState.currentEnemy + 1, 1);
  }

  // –ü–ï–†–ï–ú–ò–ö–ê–ù–ù–Ø –¢–ê–ë–Ü–í
  function switchTab(tab) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    
    document.getElementById(tab).classList.add('active');
    event.target.classList.add('active');
  }

  // –ü–û–í–Ü–î–û–ú–õ–ï–ù–ù–Ø
  function showMessage(text) {
    const msg = document.createElement('div');
    msg.className = 'message';
    msg.textContent = text;
    document.body.appendChild(msg);
    setTimeout(() => msg.remove(), 2000);
  }

  // –°–ö–ò–î–ê–ù–ù–Ø
  function resetProgress() {
    if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ? –í–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å –±—É–¥–µ –≤—Ç—Ä–∞—á–µ–Ω–æ!')) {
      gameState = {
        wins: 0,
        gold: 0,
        totalGold: 0,
        power: 1,
        currentEnemy: 0,
        enemyHp: 20,
        buildings: { forge: 1, treasury: 1, fortress: 1 }
      };
      spawnEnemy();
      updateUI();
      saveGame();
      showMessage('üîÑ –ü—Ä–æ–≥—Ä–µ—Å —Å–∫–∏–Ω—É—Ç–æ');
    }
  }

  // –°–¢–ê–†–¢
  loadGame();
</script>

</body>
</html>