<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ö–æ–∑–∞—Ü—å–∫–∞ –ê—Ä–µ–Ω–∞ üá∫üá¶</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  
  <style>
    * { 
      box-sizing: border-box; 
      margin: 0; 
      padding: 0; 
    }

    html, body {
      background: linear-gradient(180deg, #4A90E2 0%, #FFE44D 100%) !important;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      color: #000 !important;
      min-height: 100vh;
      padding: 10px;
    }

    .container {
      max-width: 400px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      padding: 15px;
      background: #ffffff !important;
      border-radius: 12px;
      margin-bottom: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .header h1 {
      font-size: 24px;
      margin-bottom: 10px;
      color: #000 !important;
    }

    .resources {
      display: flex;
      justify-content: space-around;
      font-size: 18px;
      color: #000 !important;
    }

    .resources div {
      color: #000 !important;
    }

    .tabs {
      display: flex;
      gap: 5px;
      margin-bottom: 10px;
    }

    .tab {
      flex: 1;
      padding: 12px;
      background: #e8e8e8 !important;
      border: none;
      color: #000 !important;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
    }

    .tab.active {
      background: #FFD700 !important;
      color: #000 !important;
      font-weight: bold;
    }

    .screen {
      display: none;
      background: #ffffff !important;
      padding: 20px;
      border-radius: 12px;
      min-height: 400px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .screen.active {
      display: block;
    }

    .enemy-card {
      background: linear-gradient(135deg, #ff6b6b, #ee5a6f) !important;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      margin-bottom: 20px;
    }

    .enemy-name {
      font-size: 22px;
      margin-bottom: 10px;
      color: #fff !important;
      font-weight: bold;
    }

    .enemy-hp {
      font-size: 28px;
      color: #fff !important;
      margin: 15px 0;
      font-weight: bold;
    }

    .enemy-level {
      font-size: 14px;
      color: #ffe0b2 !important;
    }

    .btn {
      width: 100%;
      padding: 16px;
      font-size: 20px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      margin-top: 10px;
      font-weight: bold;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .btn-attack {
      background: #ff5555 !important;
      color: #fff !important;
    }

    .btn-primary {
      background: #FFD700 !important;
      color: #000 !important;
    }

    .building {
      background: #f5f5f5 !important;
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 15px;
      border: 1px solid #ddd;
    }

    .building-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .building-title {
      font-size: 18px;
      color: #000 !important;
      font-weight: 600;
    }

    .building-level {
      background: #FFD700 !important;
      color: #000 !important;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: bold;
    }

    .building-desc {
      font-size: 14px;
      color: #333 !important;
      margin-bottom: 10px;
    }

    .building-cost {
      font-size: 16px;
      margin-bottom: 10px;
      color: #000 !important;
      font-weight: 500;
    }

    .btn-upgrade {
      background: #5cb85c !important;
      color: #fff !important;
      padding: 10px;
      font-size: 16px;
    }

    .btn-upgrade:disabled {
      background: #ccc !important;
      color: #666 !important;
      cursor: not-allowed;
    }

    .stats-grid {
      display: grid;
      gap: 15px;
    }

    .stat-card {
      background: #f5f5f5 !important;
      padding: 15px;
      border-radius: 12px;
      text-align: center;
      border: 1px solid #ddd;
    }

    .stat-value {
      font-size: 32px;
      font-weight: bold;
      color: #f39c12 !important;
      margin: 10px 0;
    }

    .stat-label {
      font-size: 14px;
      color: #333 !important;
    }

    .message {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.9) !important;
      color: #FFD700 !important;
      padding: 15px 30px;
      border-radius: 12px;
      font-size: 18px;
      font-weight: bold;
      z-index: 1000;
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from { top: -100px; opacity: 0; }
      to { top: 20px; opacity: 1; }
    }
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>‚öîÔ∏è –ö–æ–∑–∞—Ü—å–∫–∞ –ê—Ä–µ–Ω–∞</h1>
    <div class="resources">
      <div>üèÜ <span id="wins">0</span></div>
      <div>üí∞ <span id="gold">0</span></div>
      <div>‚ö° –°–∏–ª–∞: <span id="power">1</span></div>
    </div>
  </div>

  <div class="tabs">
    <button class="tab active" onclick="switchTab('arena')">‚öîÔ∏è –ê—Ä–µ–Ω–∞</button>
    <button class="tab" onclick="switchTab('city')">üè∞ –ú—ñ—Å—Ç–æ</button>
    <button class="tab" onclick="switchTab('stats')">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
  </div>

  <div id="arena" class="screen active">
    <div class="enemy-card">
      <div class="enemy-name" id="enemyName">–ó–∞–≥–∞—Ä–±–Ω–∏–∫</div>
      <div class="enemy-level" id="enemyLevel">–†—ñ–≤–µ–Ω—å 1</div>
      <div class="enemy-hp">‚ù§Ô∏è <span id="enemyHp">20</span></div>
    </div>
    <button class="btn btn-attack" onclick="attack()">‚öîÔ∏è –£–¥–∞—Ä (<span id="damage">1</span> —à–∫–æ–¥–∏)</button>
  </div>

  <div id="city" class="screen">
    <div class="building">
      <div class="building-header">
        <div class="building-title">‚öîÔ∏è –ö—É–∑–Ω—è</div>
        <div class="building-level">–†—ñ–≤–µ–Ω—å <span id="forgeLevel">1</span></div>
      </div>
      <div class="building-desc">–ó–±—ñ–ª—å—à—É—î —Å–∏–ª—É –∞—Ç–∞–∫–∏ –Ω–∞ +1</div>
      <div class="building-cost">üí∞ –í–∞—Ä—Ç—ñ—Å—Ç—å: <span id="forgeCost">50</span></div>
      <button class="btn btn-upgrade" onclick="upgradeBuilding('forge')" id="forgeBtn">–ü–æ–∫—Ä–∞—â–∏—Ç–∏</button>
    </div>

    <div class="building">
      <div class="building-header">
        <div class="building-title">üí∞ –°–∫–∞—Ä–±–Ω–∏—Ü—è</div>
        <div class="building-level">–†—ñ–≤–µ–Ω—å <span id="treasuryLevel">1</span></div>
      </div>
      <div class="building-desc">+10 –∑–æ–ª–æ—Ç–∞ –∑–∞ –ø–µ—Ä–µ–º–æ–≥—É</div>
      <div class="building-cost">üí∞ –í–∞—Ä—Ç—ñ—Å—Ç—å: <span id="treasuryCost">100</span></div>
      <button class="btn btn-upgrade" onclick="upgradeBuilding('treasury')" id="treasuryBtn">–ü–æ–∫—Ä–∞—â–∏—Ç–∏</button>
    </div>

    <div class="building">
      <div class="building-header">
        <div class="building-title">üè∞ –§–æ—Ä—Ç–µ—Ü—è</div>
        <div class="building-level">–†—ñ–≤–µ–Ω—å <span id="fortressLevel">1</span></div>
      </div>
      <div class="building-desc">–í—ñ–¥–∫—Ä–∏–≤–∞—î —Å–∏–ª—å–Ω—ñ—à–∏—Ö –≤–æ—Ä–æ–≥—ñ–≤</div>
      <div class="building-cost">üí∞ –í–∞—Ä—Ç—ñ—Å—Ç—å: <span id="fortressCost">200</span></div>
      <button class="btn btn-upgrade" onclick="upgradeBuilding('fortress')" id="fortressBtn">–ü–æ–∫—Ä–∞—â–∏—Ç–∏</button>
    </div>
  </div>

  <div id="stats" class="screen">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-label">–í—Å—å–æ–≥–æ –ø–µ—Ä–µ–º–æ–≥</div>
        <div class="stat-value" id="totalWins">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">–ó–∞—Ä–æ–±–ª–µ–Ω–æ –∑–æ–ª–æ—Ç–∞</div>
        <div class="stat-value" id="totalGold">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">–ü–æ—Ç–æ—á–Ω–∞ —Å–∏–ª–∞</div>
        <div class="stat-value" id="totalPower">1</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">–ù–∞–π—Å–∏–ª—å–Ω—ñ—à–∏–π –≤–æ—Ä–æ–≥</div>
        <div class="stat-value" id="maxEnemy">1</div>
      </div>
    </div>
    <button class="btn btn-primary" onclick="resetProgress()" style="margin-top: 20px;">üîÑ –°–∫–∏–Ω—É—Ç–∏ –ø—Ä–æ–≥—Ä–µ—Å</button>
  </div>
</div>

<script>
  const tg = window.Telegram.WebApp;
  tg.ready();
  tg.expand();

  const enemies = [
    { name: "–ó–∞–≥–∞—Ä–±–Ω–∏–∫", hp: 20, gold: 10, level: 1 },
    { name: "–í–æ—è–∫", hp: 35, gold: 20, level: 2 },
    { name: "–û–ø—Ä–∏—á–Ω–∏–∫", hp: 60, gold: 35, level: 3 },
    { name: "–®–ª—è—Ö—Ç–∏—á", hp: 100, gold: 60, level: 4 },
    { name: "–ë–æ—è—Ä–∏–Ω", hp: 150, gold: 100, level: 5 },
    { name: "–í–æ—î–≤–æ–¥–∞", hp: 250, gold: 180, level: 6 },
    { name: "–ì–µ–Ω–µ—Ä–∞–ª", hp: 400, gold: 300, level: 7 }
  ];

  let gameState = {
    wins: 0,
    gold: 0,
    totalGold: 0,
    power: 1,
    currentEnemy: 0,
    enemyHp: 20,
    buildings: { forge: 1, treasury: 1, fortress: 1 }
  };

  function loadGame() {
    if (tg.CloudStorage) {
      tg.CloudStorage.getItem('gameState', (err, data) => {
        if (data) {
          gameState = JSON.parse(data);
          spawnEnemy();
          updateUI();
        } else {
          spawnEnemy();
        }
      });
    } else {
      const saved = localStorage.getItem('kozakGame');
      if (saved) {
        gameState = JSON.parse(saved);
        spawnEnemy();
      }
      updateUI();
    }
  }

  function saveGame() {
    const data = JSON.stringify(gameState);
    if (tg.CloudStorage) {
      tg.CloudStorage.setItem('gameState', data);
    } else {
      localStorage.setItem('kozakGame', data);
    }
  }

  function spawnEnemy() {
    const maxLevel = Math.min(gameState.buildings.fortress, enemies.length - 1);
    gameState.currentEnemy = Math.floor(Math.random() * (maxLevel + 1));
    const enemy = enemies[gameState.currentEnemy];
    gameState.enemyHp = enemy.hp;
  }

  function attack() {
    gameState.enemyHp -= gameState.power;
    tg.HapticFeedback.impactOccurred("medium");

    if (gameState.enemyHp <= 0) {
      const enemy = enemies[gameState.currentEnemy];
      const goldReward = enemy.gold + (gameState.buildings.treasury - 1) * 10;
      
      gameState.wins++;
      gameState.gold += goldReward;
      gameState.totalGold += goldReward;

      showMessage(`üèÜ –ü–µ—Ä–µ–º–æ–≥–∞! +${goldReward} üí∞`);
      tg.HapticFeedback.notificationOccurred("success");

      spawnEnemy();
    }

    updateUI();
    saveGame();
  }

  function upgradeBuilding(type) {
    const costs = {
      forge: 50 * gameState.buildings.forge,
      treasury: 100 * gameState.buildings.treasury,
      fortress: 200 * gameState.buildings.fortress
    };

    const cost = costs[type];

    if (gameState.gold >= cost) {
      gameState.gold -= cost;
      gameState.buildings[type]++;

      if (type === 'forge') {
        gameState.power = gameState.buildings.forge;
      }

      showMessage(`‚úÖ –ü–æ–∫—Ä–∞—â–µ–Ω–æ!`);
      tg.HapticFeedback.notificationOccurred("success");
      updateUI();
      saveGame();
    } else {
      showMessage(`‚ùå –ù–µ –≤–∏—Å—Ç–∞—á–∞—î –∑–æ–ª–æ—Ç–∞`);
      tg.HapticFeedback.notificationOccurred("error");
    }
  }

  function updateUI() {
    const enemy = enemies[gameState.currentEnemy];

    document.getElementById('wins').textContent = gameState.wins;
    document.getElementById('gold').textContent = gameState.gold;
    document.getElementById('power').textContent = gameState.power;
    document.getElementById('damage').textContent = gameState.power;

    document.getElementById('enemyName').textContent = enemy.name;
    document.getElementById('enemyLevel').textContent = `–†—ñ–≤–µ–Ω—å ${enemy.level}`;
    document.getElementById('enemyHp').textContent = gameState.enemyHp;

    document.getElementById('forgeLevel').textContent = gameState.buildings.forge;
    document.getElementById('forgeCost').textContent = 50 * gameState.buildings.forge;
    document.getElementById('forgeBtn').disabled = gameState.gold < 50 * gameState.buildings.forge;

    document.getElementById('treasuryLevel').textContent = gameState.buildings.treasury;
    document.getElementById('treasuryCost').textContent = 100 * gameState.buildings.treasury;
    document.getElementById('treasuryBtn').disabled = gameState.gold < 100 * gameState.buildings.treasury;

    document.getElementById('fortressLevel').textContent = gameState.buildings.fortress;
    document.getElementById('fortressCost').textContent = 200 * gameState.buildings.fortress;
    document.getElementById('fortressBtn').disabled = gameState.gold < 200 * gameState.buildings.fortress || gameState.buildings.fortress >= enemies.length;

    document.getElementById('totalWins').textContent = gameState.wins;
    document.getElementById('totalGold').textContent = gameState.totalGold;
    document.getElementById('totalPower').textContent = gameState.power;
    document.getElementById('maxEnemy').textContent = Math.max(gameState.currentEnemy + 1, 1);
  }

  function switchTab(tab) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    
    document.getElementById(tab).classList.add('active');
    event.target.classList.add('active');
  }

  function showMessage(text) {
    const msg = document.createElement('div');
    msg.className = 'message';
    msg.textContent = text;
    document.body.appendChild(msg);
    setTimeout(() => msg.remove(), 2000);
  }

  function resetProgress() {
    if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ? –í–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å –±—É–¥–µ –≤—Ç—Ä–∞—á–µ–Ω–æ!')) {
      gameState = {
        wins: 0,
        gold: 0,
        totalGold: 0,
        power: 1,
        currentEnemy: 0,
        enemyHp: 20,
        buildings: { forge: 1, treasury: 1, fortress: 1 }
      };
      spawnEnemy();
      updateUI();
      saveGame();
      showMessage('üîÑ –ü—Ä–æ–≥—Ä–µ—Å —Å–∫–∏–Ω—É—Ç–æ');
    }
  }

  loadGame();
</script>

</body>
</html>